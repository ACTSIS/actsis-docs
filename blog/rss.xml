<?xml version="1.0" encoding="utf-8"?>
<rss version="2.0" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:content="http://purl.org/rss/1.0/modules/content/">
    <channel>
        <title>Docs Blog</title>
        <link>https://actsis.github.io/blog</link>
        <description>Docs Blog</description>
        <lastBuildDate>Tue, 01 Aug 2023 00:00:00 GMT</lastBuildDate>
        <docs>https://validator.w3.org/feed/docs/rss2.html</docs>
        <generator>https://github.com/jpmonette/feed</generator>
        <language>es</language>
        <item>
            <title><![CDATA[Monitoreo sitios OCI]]></title>
            <link>https://actsis.github.io/blog/monitoreo-sitios-oci</link>
            <guid>https://actsis.github.io/blog/monitoreo-sitios-oci</guid>
            <pubDate>Tue, 01 Aug 2023 00:00:00 GMT</pubDate>
            <description><![CDATA[Monitoreo sitios OCI y pruebas de rendimiento con Grafana y JMeter]]></description>
            <content:encoded><![CDATA[<p>Eightshift DevKit offers some blocks with query logic out of the box, but what is the best approach when you need to add a custom query to a block you’ve been working on?</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="usage-in-built-in-blocks">Usage in built-in blocks<a href="#usage-in-built-in-blocks" class="hash-link" aria-label="Enlace directo al Usage in built-in blocks" title="Enlace directo al Usage in built-in blocks">​</a></h2><p>One of the Eightshift blocks that already uses <code>WP_Query</code> is the <strong><em>Featured Content</em></strong> block. In that block, you can see the query logic is inside the block. However, there is a much better way to do it. The reason it was done like this was to simplify this block and to have an already functioning block available with one WP-CLI command.</p><p>A much better approach would be to separate the query logic from the block. Other than following the MVC architecture more closely, this will also make the query logic more reusable. To do this, we’re gonna create a service class.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="what-are-service-classes">What are Service classes?<a href="#what-are-service-classes" class="hash-link" aria-label="Enlace directo al What are Service classes?" title="Enlace directo al What are Service classes?">​</a></h2><p><em>Put simply, a Service is any PHP object that performs some sort of "global" task. - Symfony docs</em></p><p>If you take a look at the <code>ServiceInterface</code> interface, you’ll notice it only contains the <code>register()</code> method. This method holds action and filter hooks for that class. Other than hooking into existing actions and filters, this method can be used to register our own filters which can be used in blocks or other classes.</p><p>Basically, whenever you need to hook into actions or filters, you should use a Service class for that.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="creating-a-new-service-class">Creating a new service class<a href="#creating-a-new-service-class" class="hash-link" aria-label="Enlace directo al Creating a new service class" title="Enlace directo al Creating a new service class">​</a></h2><p>Creating a new service class in your project is as simple as using the following WP-CLI command:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">wp boilerplate create service-example --folder</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">CustomQuery --file_name</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">CustomQuery</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copiar código al portapapeles" title="Copiar" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Once this new class is generated, you can add a new public method that will contain the query logic. We want our method to accept three optional arguments:</p><ul><li>ID of the category</li><li>number of posts per page</li><li>number of the current page</li></ul><p>Having the category ID optional will allow for one more use case, and that is fetching the latest posts regardless of category. By default, WordPress sorts the posts by publish date, from newest to oldest.</p><div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">/**</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> * Get posts by category ID.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> *</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> * @param int $categoryId Category ID.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> * @param int $postsPerPage Number of posts per page.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> * @param int $currentPage Current page number.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> *</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> * @return WP_Query Query object.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> */</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">public function getPostsByCategory($categoryId = null, $postsPerPage = 3, $currentPage = 1): WP_Query</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">{</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    $postArgs = [</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        'post_type' =&gt; 'post',</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        'cat' =&gt; $categoryId,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        'posts_per_page' =&gt; $postsPerPage,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        'paged' =&gt; $currentPage,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    ];</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    return new WP_Query($postArgs);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copiar código al portapapeles" title="Copiar" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>To use this method, we can add it as a filter. The filter name should be added as a constant for easier maintenance. Inside the <code>register()</code> method, add the following:</p><div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">\add_filter(self::GET_POSTS_BY_CATEGORY, [$this, 'getPostsByCategory'], 10, 3);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copiar código al portapapeles" title="Copiar" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="using-the-new-filter">Using the new filter<a href="#using-the-new-filter" class="hash-link" aria-label="Enlace directo al Using the new filter" title="Enlace directo al Using the new filter">​</a></h2><div class="es-alert es-alert--note m-0 my-10 pl-10 pr-0 py-4 border-l-4 border-l-infinum border-l-violet-30"><i class="flex gap-1.5 items-center font-sans text-12 uppercase not-italic leading-none font-medium mb-2"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24" fill="none" class="w-6 h-6 text-violet-30"><path d="M3.852 20.148h10.74v-5.555h5.556V3.852H3.852v16.296Zm0 1.852c-.51 0-.945-.181-1.308-.544A1.783 1.783 0 0 1 2 20.148V3.852c0-.51.181-.945.544-1.308A1.783 1.783 0 0 1 3.852 2h16.296c.51 0 .945.181 1.308.544.363.363.544.799.544 1.308v11.481L15.333 22H3.852Zm2.963-8.148V12h5v1.852h-5Zm0-4.445V7.556h10.37v1.851H6.815Z" fill="currentColor"></path></svg><span class="text-grey-500">Note</span></i><div class="font-sans text-16 text-black"><p>Even if you register a filter for a method that doesn’t accept any arguments, when calling <code>apply_filters</code>, you must pass at least 1 parameter. In those cases, simply add <code>null</code> as a parameter.</p></div></div><p>Here are some examples how you can use the filter:</p><div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">// Get 3 latest posts, regardless of category.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">$allLatestPosts = apply_filters(CustomQuery::GET_POSTS_BY_CATEGORY, null);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">// Get 10 latest posts from the News category. News category ID is 2.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">$latestNews = apply_filters(CustomQuery::GET_POSTS_BY_CATEGORY, 2, 10);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">// Get another page of News category.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">$pagedNews = apply_filters(CustomQuery::GET_POSTS_BY_CATEGORY, 2, 10, $currentPage);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copiar código al portapapeles" title="Copiar" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The above example shows multiple use cases. The first two examples could be used in a simple block that displays only the selected number of the latest posts. The last example may be used in a REST route for a load more functionality or in a block with classic pagination.</p><p>Now you can do a regular query loop in your block to display the posts:</p><div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">if ($latestNews-&gt;have_posts()) {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    while ($latestNews-&gt;have_posts()) {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        $latestNews-&gt;the_post();</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        // render the card here with the Components::render helper.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">wp_reset_postdata();</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copiar código al portapapeles" title="Copiar" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="es-alert es-alert--caution m-0 my-10 pl-10 pr-0 py-4 border-l-4 border-l-infinum border-l-candy-30"><i class="flex gap-1.5 items-center font-sans text-12 uppercase not-italic leading-none font-medium mb-2"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24" fill="none" class="w-6 h-6 text-candy-30"><path d="M1 21 12 2l11 19H1Zm2.883-1.667h16.234L12 5.333l-8.117 14Zm8.187-1.283a.815.815 0 0 0 .83-.836.815.815 0 0 0-.836-.83.814.814 0 0 0-.83.836.814.814 0 0 0 .836.83Zm-.837-2.85H12.9V9.8h-1.667v5.4Z" fill="currentColor"></path></svg><span class="text-grey-500">Important</span></i><div class="font-sans text-16 text-black"><p>Don't forget to add <code>wp_reset_postdata()</code> after looping through the custom query!</p></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="prepare-only-the-data-you-need">Prepare only the data you need<a href="#prepare-only-the-data-you-need" class="hash-link" aria-label="Enlace directo al Prepare only the data you need" title="Enlace directo al Prepare only the data you need">​</a></h2><p>If you would like to improve this even further, you can run the <code>have_posts()</code> loop inside the class and save only the data you need to render to an array. This makes the logic even more separated from the view and all you have to do in a block is loop through the array and populate the component attributes with the values from the array.</p><div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$postData = [];</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">if ($queryData-&gt;have_posts()) {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    while($queryData-&gt;have_posts()) {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        $queryData-&gt;the_post();</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        $postData[] = [</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            'id' =&gt; get_the_ID(),</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            'title' =&gt; get_the_title(),</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            'url' =&gt; get_permalink(),</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            'image' =&gt; get_the_post_thumbnail_url(),</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            'date' =&gt; get_the_time('d.m.Y.'),</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            'excerpt' =&gt; get_the_excerpt(),</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        ];</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">wp_reset_postdata();</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">return $postData;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copiar código al portapapeles" title="Copiar" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="best-practices-for-queries">Best practices for queries<a href="#best-practices-for-queries" class="hash-link" aria-label="Enlace directo al Best practices for queries" title="Enlace directo al Best practices for queries">​</a></h2><p>It’s important to have query optimisation in mind. Some queries may be a lot slower and you have to see if there is any way to follow the <a href="https://infinum.com/handbook/wordpress/coding-standards/php-coding-standards/database-queries" target="_blank" rel="noopener noreferrer">best practices for database queries</a>.</p>]]></content:encoded>
            <category>actsis</category>
            <category>grafana</category>
            <category>service</category>
            <category>jmeter</category>
        </item>
    </channel>
</rss>